# ze

**Zig Editor** / **Zero-latency Editor**

SSH先でサクッと使える、設定不要の軽量で高速なモダンなエディタ。

## Why ze?

- **軽量** — 5MB以下、依存なし
- **ゼロコンフィグ** — dotfileなし、コピーして即使用
- **Emacsキーバインド** — Bash/Readlineユーザーに自然
- **UTF-8完全対応** — 日本語、絵文字、どんな文字もサポートしています。
- **シェル統合** — Unixコマンドをエディタ内からパイプできます。

## Install

```bash
# ビルド
zig build -Doptimize=ReleaseFast

# パスを通す（任意）
cp ./zig-out/bin/ze ~/.local/bin/
```

## Quick Start

```bash
ze file.txt          # ファイルを開く
ze                    # 新規バッファで起動
```

保存して終了: `C-x C-s` → `C-x C-c`

---

## Keybindings

zeはEmacsスタイルのキーバインドを採用しています。`C-` は Ctrl、`M-` は Alt/Option。

### 移動

| キー | 動作 |
|------|------|
| `C-f` / `C-b` | 1文字 前進/後退 |
| `C-n` / `C-p` | 次行/前行 |
| `C-a` / `C-e` | 行頭/行末 |
| `M-f` / `M-b` | 単語単位で前進/後退 |
| `C-v` / `M-v` | ページダウン/アップ |
| `M-<` / `M->` | バッファ先頭/末尾 |
| `C-l` | カーソル行を画面中央に |

### 編集

| キー | 動作 |
|------|------|
| `C-d` | 1文字削除 |
| `M-d` | 単語削除 |
| `C-k` | 行末まで削除 |
| `C-Space` | マーク設定/解除(範囲選択開始/解除) |
| `C-w` / `M-w` | カット/コピー |
| `C-y` | ペースト |
| `C-u` / `C-/` | Undo/Redo |
| `M-^` | 行を上の行と結合 |
| `M-↑` / `M-↓` | 行を上/下に移動 |
| `Tab` / `S-Tab` | インデント/アンインデント |
| `M-;` | コメント切り替え |

### ファイル

| キー | 動作 |
|------|------|
| `C-x C-f` | ファイルを開く |
| `C-x C-s` | 保存 |
| `C-x C-w` | 名前を付けて保存 |
| `C-x C-c` | 終了 |

### 検索・置換

| キー | 動作 |
|------|------|
| `C-s` / `C-r` | 前方/後方検索 |
| `M-%` | 対話的置換 (y/n/!/q) |

正規表現も使えます: `\d+` で数字、`^TODO` で行頭のTODO。

### ウィンドウ・バッファ

| キー | 動作 |
|------|------|
| `C-x 2` / `C-x 3` | 横分割/縦分割 |
| `C-x o` | 次のウィンドウへ |
| `C-x 0` / `C-x 1` | ウィンドウを閉じる/他を閉じる |
| `C-x b` | バッファ切り替え |
| `C-x C-b` | バッファ一覧 |
| `C-x k` | バッファを閉じる |

---

## Shell Integration

zeは「テキストはストリーム」というUnix哲学に基づいています。

高度なテキスト処理は `sort`、`jq`、`awk`、`sed` など既に存在する優れたツールに任せ、zeはそれらとバッファを繋ぐパイプラインの役割に徹します。車輪の再発明はしません。

`M-|` でシェルコマンドを実行し、選択範囲やバッファ全体をパイプで渡せます。

### 構文

```
[入力元] | コマンド [出力先]
```

### 入力元

| 記号 | 入力 |
|------|------|
| (なし) | 選択範囲 |
| `%` | バッファ全体 |
| `.` | 現在行 |

### 出力先

| 記号 | 出力 |
|------|------|
| (なし) | コマンドバッファに表示 |
| `>` | 入力元を置換 |
| `+>` | カーソル位置に挿入 |
| `n>` | 新規バッファ |

### 例

```bash
| date +>              # 日付をカーソル位置に挿入
| sort >               # 選択範囲をソートして置換
% | jq . >             # JSON全体を整形
. | sh >               # 現在行をシェル実行
% | grep TODO n>       # TODO行を新規バッファに抽出
```

**C-g** でいつでもキャンセル可能。LLM呼び出しなど長時間処理もOK。

---

## M-x Commands

`M-x` でコマンドプロンプトが開きます。

| コマンド | 説明 |
|---------|------|
| `line 100` | 100行目へジャンプ |
| `tab` / `tab 2` | タブ幅表示/設定 |
| `indent` | インデントスタイル表示/設定 |
| `revert` | ファイル再読み込み |
| `ro` | 読み取り専用切り替え |
| `?` | コマンド一覧 |

---

## Features

### エンコーディング

- **UTF-8 + LF** に最適化しています。ファイル読み込み時にUTF-8+LFに変換します。UTF-8+LFの場合はmmap でゼロコピー読み込みます。
- UTF-8(BOM付き、なし)、UTF-16(BOM付き)、Shift_JIS、EUC-JPのエンコーディングや改行コード(LF, CRLF, CR) も自動検出・変換します。
- 保存時は元のエンコーディング、改行コードを保持します。
> 上記以外のエンコードやzeではサポートしていません。必要な場合はiconvやnkfで変換してください。


## Roadmap

### 実装済み

- Piece Tableバッファ、Undo/Redo
- Grapheme cluster対応（絵文字、CJK完全サポート）
- インクリメンタル検索、正規表現、Query Replace
- マルチバッファ、ウィンドウ分割
- シェル統合 (M-|)
- 48言語のコメント・インデント設定
- カラーはコメントのみサポート

### 予定

- [ ] アプリ内ヘルプ (`C-h ?`)
- [ ] キーボードマクロ (`C-x (` / `)` / `e`)

### 実装しない

- シンタックスハイライト — zeは設定ファイルエディタ、IDEではない
- LSP — 本格的な開発はVSCodeで
- プラグイン — シンプルさを維持
- マウス — キーボード操作のみ
- GUI — ターミナル専用

---

## Philosophy

1. **Speed** — 8ms以下の応答性。ゲームレベル。
2. **Minimal** — 一つのことを上手く行う。
3. **Unix** — テキストはストリーム。パイプはファーストクラス。
4. **Zero-config** — コピーして即使える。

---

## Inspiration

- [mg](https://github.com/hboetes/mg) — ミニマルなEmacs
- [kilo](https://github.com/antirez/kilo) — 1000行エディタ
- [vis](https://github.com/martanne/vis) — 構造的正規表現

---

## License

MIT

---

*"一つのことを上手く行う。高速に。"*
